<div class="stock-overview">
    <!-- Header -->
    <div class="overview-header">
        <div class="header-content">
            <h2 class="text-gray-700 mb-0">Stock Summary</h2>
            <p>Ringkasan stok produk per warehouse</p>
        </div>

        <!-- Warehouse Filter -->
        <div class="flex gap-5 items-center w-3/12">
            <div class="w-4/12">
                <label class="text-sm text-gray-700">Pilih Warehouse :</label>
            </div>
            <div class="w-8/12">
                <p-select [(ngModel)]="selectedWarehouseId" (onChange)="onWarehouseChange($event)"
                    [options]="warehouses" optionValue="id" optionLabel="name" styleClass="p-inputtext-sm w-full"
                    size="small" appendTo="body" [filter]="true" [showClear]="false">
                </p-select>
            </div>
        </div>
    </div>

    <!-- Stock Table -->
    <div class="stock-table-container">
        <p-table [value]="stockData" [loading]="isLoading" [paginator]="true" [rows]="10"
            [globalFilterFields]="['product_name', 'product_sku']" [tableStyle]="{ 'min-width': '50rem' }">
            <!-- Column: Product -->
            <ng-template pTemplate="header">
                <tr>
                    <th class="text-sm" pSortableColumn="product_sku">SKU <p-sortIcon field="product_sku"></p-sortIcon>
                    </th>
                    <th class="text-sm" pSortableColumn="product_name">Nama Produk <p-sortIcon
                            field="product_name"></p-sortIcon></th>
                    <th class="text-sm" pSortableColumn="total_stock">Total Stock <p-sortIcon
                            field="total_stock"></p-sortIcon></th>
                    @if (hasBatchTracking) {
                    <th class="text-sm">Batch Qty</th>
                    }
                    @if (hasSerialTracking) {
                    <th class="text-sm">Serial Qty</th>
                    }
                    @if (hasGeneralTracking) {
                    <th class="text-sm">General Qty</th>
                    }
                    <th class="text-sm">Tipe Tracking</th>
                    <th class="text-sm" style="width: 150px;">Detail Stok</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-stock>
                <tr>
                    <!-- SKU -->
                    <td class="text-sm">
                        <span class="badge bg-info">{{ stock.product_sku }}</span>
                    </td>

                    <!-- Product Name -->
                    <td class="text-sm">
                        <strong>{{ stock.product_name }}</strong>
                    </td>

                    <!-- Total Stock -->
                    <td class="text-sm">
                        <span class="badge" [ngClass]="getStockBadgeClass(stock.total_stock)">
                            {{ stock.total_stock }} unit
                        </span>
                    </td>

                    <!-- Batch Quantity -->
                    @if (hasBatchTracking) {
                    <td class="text-sm">
                        @if (stock.is_batch_tracked) {
                        <span>{{ stock.batch_quantity }}</span>
                        } @else {
                        <span class="text-muted">-</span>
                        }
                    </td>
                    }

                    <!-- Serial Quantity -->
                    @if (hasSerialTracking) {
                    <td class="text-sm">
                        @if (stock.is_serial_tracked) {
                        <span>{{ stock.serial_quantity }}</span>
                        } @else {
                        <span class="text-muted">-</span>
                        }
                    </td>
                    }

                    <!-- General Quantity -->
                    @if (hasGeneralTracking) {
                    <td class="text-sm">
                        @if (!stock.is_batch_tracked && !stock.is_serial_tracked) {
                        <span>{{ stock.general_quantity }}</span>
                        } @else {
                        <span class="text-muted">-</span>
                        }
                    </td>
                    }

                    <!-- Tracking Type Badge -->
                    <td class="text-sm">
                        @if (stock.is_batch_tracked) {
                        <span class="badge bg-warning text-dark" pTooltip="Batch Tracking" tooltipPosition="top">
                            ï¿½ Baltch
                        </span>
                        }
                        @if (stock.is_serial_tracked) {
                        <span class="badge bg-primary" pTooltip="Serial Tracking" tooltipPosition="top">
                            ðŸ”¢ Serial
                        </span>
                        }
                        @if (!stock.is_batch_tracked && !stock.is_serial_tracked) {
                        <span class="badge bg-secondary" pTooltip="General Stock" tooltipPosition="top">
                            ðŸ“‹ General
                        </span>
                        }
                    </td>

                    <!-- Action -->
                    <td class="text-sm">
                        <button pButton type="button" icon="pi pi-list"
                            class="p-button-rounded p-button-info p-button-sm"
                            [pTooltip]="'Lihat detail pergerakan stok ' + stock.product_name" tooltipPosition="top"
                            (click)="openDetailModal(stock)">
                        </button>
                    </td>
                </tr>
            </ng-template>

            <!-- Empty Message -->
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="8" class="text-center p-4">
                        <p class="text-muted">Tidak ada data stok untuk warehouse ini</p>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>

    <!-- Detail Modal Component -->
    <app-stock-detail-modal [(visible)]="showDetailModal" [selectedStock]="selectedStock"></app-stock-detail-modal>
</div>