<app-dsh-base-layout>
    <div class="flex flex-col w-full h-full gap-5 p-3">
        <div class="grid w-full p-5 bg-white rounded-lg shadow-sm">
            <app-dynamic-table [props]="TableProps" (onToolbarClicked)="handleToolbarClick($event)">
            </app-dynamic-table>
        </div>
    </div>

    <!-- Detail Transaction Modal -->
    <p-dialog header="Detail Transaksi" [(visible)]="_modalToggler.detail" [modal]="true" [style]="{ width: '600px' }"
        [draggable]="false" [resizable]="false">

        @if (SelectedTransaction) {
        <div class="transaction-detail">
            <div class="detail-header">
                <div class="detail-row">
                    <span class="label">No. Transaksi</span>
                    <span class="value">{{ SelectedTransaction.transaction_number }}</span>
                </div>
                <div class="detail-row">
                    <span class="label">Tanggal</span>
                    <span class="value">{{ SelectedTransaction.transaction_date | date:'dd MMM yyyy HH:mm' }}</span>
                </div>
                <div class="detail-row">
                    <span class="label">Kasir</span>
                    <span class="value">{{ SelectedTransaction.cashier?.full_name || '-' }}</span>
                </div>
            </div>

            <div class="detail-items">
                <h4>Daftar Item</h4>
                <table class="items-table">
                    <thead>
                        <tr>
                            <th>Produk</th>
                            <th>Qty</th>
                            <th>Harga</th>
                            <th>Subtotal</th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (item of SelectedTransaction.items; track item.id) {
                        <tr>
                            <td>{{ item.product_name }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ item.unit_price | currency:'IDR':'symbol':'1.0-0' }}</td>
                            <td>{{ item.subtotal | currency:'IDR':'symbol':'1.0-0' }}</td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="detail-summary">
                <div class="summary-row">
                    <span>Subtotal</span>
                    <span>{{ SelectedTransaction.subtotal | currency:'IDR':'symbol':'1.0-0' }}</span>
                </div>
                @if (SelectedTransaction.discount_amount && SelectedTransaction.discount_amount > 0) {
                <div class="summary-row discount">
                    <span>Diskon</span>
                    <span>-{{ SelectedTransaction.discount_amount | currency:'IDR':'symbol':'1.0-0' }}</span>
                </div>
                }
                <div class="summary-row total">
                    <span>Total</span>
                    <span>{{ SelectedTransaction.total | currency:'IDR':'symbol':'1.0-0' }}</span>
                </div>
                <div class="summary-row">
                    <span>Metode Pembayaran</span>
                    <span>{{ SelectedTransaction.payment_method }}</span>
                </div>
                @if (SelectedTransaction.payment_method === 'CASH') {
                <div class="summary-row">
                    <span>Uang Diterima</span>
                    <span>{{ SelectedTransaction.amount_paid | currency:'IDR':'symbol':'1.0-0' }}</span>
                </div>
                <div class="summary-row">
                    <span>Kembalian</span>
                    <span>{{ SelectedTransaction.change_amount | currency:'IDR':'symbol':'1.0-0' }}</span>
                </div>
                }
            </div>
        </div>
        }

        <ng-template pTemplate="footer">
            <p-button label="Cetak Ulang" icon="pi pi-print" severity="secondary"
                (onClick)="printReceipt(SelectedTransaction!)"></p-button>
            <p-button label="Tutup" (onClick)="closeDetailModal()"></p-button>
        </ng-template>
    </p-dialog>
</app-dsh-base-layout>