<app-dsh-base-layout>
    <div class="time-off-container rounded-lg p-5">
        <!-- Header -->
        <div class="time-off-header">
            <div class="header-left">
                <h1 class="page-title">Time off</h1>
            </div>
            <div class="header-right">
                <p-button label="Assign to.." icon="pi pi-user-plus" severity="secondary" (onClick)="openAssignDialog()"
                    styleClass="p-button-sm">
                </p-button>
                <p-button label="Create time-off" icon="pi pi-plus" severity="primary" (onClick)="openCreateDialog()"
                    styleClass="p-button-sm">
                </p-button>
            </div>
        </div>

        <!-- Department Tabs -->
        <div class="department-tabs">
            @for (dept of departments(); track dept.id) {
            <button class="tab-button" [class.active]="selectedDepartment() === dept.id"
                (click)="onDepartmentChange(dept.id)">
                {{ dept.title }}
            </button>
            }
        </div>

        <!-- Main Content -->
        <div class="time-off-content">
            <!-- Left Sidebar: Employee List -->
            <div class="employee-sidebar">
                <!-- Search -->
                <div class="search-box">
                    <span class="p-input-icon-left w-full">
                        <i class="pi pi-search"></i>
                        <input type="text" pInputText placeholder="Search employee.." [(ngModel)]="searchQuery"
                            (ngModelChange)="onSearch($event)" class="w-full">
                    </span>
                </div>

                <!-- Employee List -->
                <div class="employee-list">
                    @for (employee of filteredEmployees(); track employee.id) {
                    <div class="employee-item">
                        <div class="employee-info">
                            <p class="employee-name">{{ employee.full_name }}</p>
                            <p class="employee-position">{{ employee.position.title }}</p>
                        </div>
                    </div>
                    }

                    @if (filteredEmployees().length === 0) {
                    <div class="empty-state">
                        <p>No employees found</p>
                    </div>
                    }
                </div>
            </div>

            <!-- Right: Timeline Calendar -->
            <div class="timeline-calendar">
                <!-- Calendar Navigation -->
                <div class="calendar-nav">
                    <p-button icon="pi pi-chevron-left" severity="secondary" (onClick)="previousMonth()"
                        styleClass="p-button-text p-button-sm">
                    </p-button>
                    <p-button label="Today" severity="secondary" (onClick)="goToToday()" styleClass="p-button-sm">
                    </p-button>
                    <p-button icon="pi pi-chevron-right" severity="secondary" (onClick)="nextMonth()"
                        styleClass="p-button-text p-button-sm">
                    </p-button>
                </div>

                <!-- Calendar Header (Days) -->
                <div class="calendar-header">
                    @for (day of visibleDays(); track day.date) {
                    <div class="calendar-day-header" [class.today]="day.isToday" [class.weekend]="day.isWeekend">

                        <!-- Month separator -->
                        @if ($index === 0 || day.dayNumber === 1) {
                        <div class="month-label">{{ day.month }}</div>
                        }

                        <!-- Day number -->
                        <div class="day-number">{{ day.dayNumber }}</div>

                        <!-- Today marker -->
                        @if (day.isToday) {
                        <div class="today-badge">Today</div>
                        }
                    </div>
                    }
                </div>

                <!-- Calendar Body (Timeline Rows) -->
                <div class="calendar-body">
                    @for (employee of filteredEmployees(); track employee.id; let rowIndex = $index) {
                    <div class="timeline-row">
                        <!-- Day cells background -->
                        @for (day of visibleDays(); track day.date) {
                        <div class="day-cell" [class.today]="day.isToday" [class.weekend]="day.isWeekend">
                        </div>
                        }

                        <!-- Time-off entries overlay -->
                        <div class="entries-overlay">
                            @for (position of timeOffPositions(); track position.entry.id) {
                            @if (position.rowIndex === rowIndex) {
                            <div class="leave-entry" [class.time-off]="position.entry.leave_policy_id === 'time-off'"
                                [class.holiday]="position.entry.leave_policy_id === 'holiday'"
                                [class.sick]="position.entry.leave_policy_id === 'sick'"
                                [class.vacation]="position.entry.leave_policy_id === 'vacation'"
                                [style.left.%]="position.left" [style.width.%]="position.width">
                                <span class="leave-label">
                                    {{ getLeaveTypeName(position.entry.type) }}
                                </span>
                            </div>
                            }
                            }
                        </div>
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Create Time-off Dialog -->
    <p-dialog [(visible)]="showCreateDialog" [modal]="true" [style]="{width: '500px'}" header="Create Time-off">

        <div class="dialog-content">
            <p>Create time-off dialog content goes here...</p>
            <!-- Add form fields here -->
        </div>

        <ng-template pTemplate="footer">
            <p-button label="Cancel" severity="secondary" (onClick)="closeDialogs()">
            </p-button>
            <p-button label="Create" severity="primary" (onClick)="closeDialogs()">
            </p-button>
        </ng-template>
    </p-dialog>

    <!-- Assign Dialog -->
    <p-dialog [(visible)]="showAssignDialog" [modal]="true" [style]="{width: '500px'}" header="Assign Time-off">

        <div class="dialog-content">
            <p>Assign time-off dialog content goes here...</p>
            <!-- Add form fields here -->
        </div>

        <ng-template pTemplate="footer">
            <p-button label="Cancel" severity="secondary" (onClick)="closeDialogs()">
            </p-button>
            <p-button label="Assign" severity="primary" (onClick)="closeDialogs()">
            </p-button>
        </ng-template>
    </p-dialog>
</app-dsh-base-layout>