<app-dsh-base-layout>
    <!-- List View -->
    <div *ngIf="_pageState() === 'list'" class="grid w-full p-5 bg-white rounded-lg shadow-sm">
        <app-dynamic-table [props]="TableProps" (onCustomButtonClicked)="handleCustomButtonClicked($event)"
            (onToolbarClicked)="handleToolbarClicked($event)" (onFilter)="handleFilter($event)"
            (onSort)="handleSort($event)">
        </app-dynamic-table>
    </div>

    <!-- Create/Edit View -->
    <div *ngIf="_pageState() === 'create' || _pageState() === 'edit'" class="flex flex-col w-full gap-5">
        <!-- Header -->
        <div class="flex flex-row justify-between items-center bg-white p-5 rounded-lg shadow-sm">
            <div class="flex flex-col">
                <p class="text-lg font-semibold text-gray-700">
                    {{ _pageState() === 'create' ? 'Tambah Lembur' : 'Edit Lembur' }}
                </p>
                <p class="text-sm text-gray-500">
                    {{ _pageState() === 'edit'
                    ? 'Tambahkan data lembur karyawan baru ke sistem'
                    : 'Ubah data lembur karyawan yang sudah ada' }}
                </p>
            </div>

            <p-button severity="secondary" label="Kembali" icon="pi pi-arrow-left" (onClick)="handleBackToList()"
                styleClass="p-button-sm">
            </p-button>
        </div>

        <form [formGroup]="OvertimeForm" class="grid w-full p-5 bg-white rounded-lg shadow-sm">
            <div class="row">
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label>Karyawan</label>
                        <p-select [options]="_employeeDatasource" optionLabel="full_name" optionValue="id"
                            formControlName="employee_id" [showClear]="true" placeholder="Pilih Karyawan"
                            [filter]="true" size="small" appendTo="body">
                            <ng-template let-option pTemplate="item">
                                <div class="flex flex-col w-full">
                                    <span class="text-sm font-medium">{{ option.full_name }}</span>
                                    <span class="text-xs text-gray-600">
                                        {{ option.department?.title }} - {{ option.position?.title }}
                                    </span>
                                </div>
                            </ng-template>
                        </p-select>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label>Tanggal</label>
                        <p-datepicker formControlName="date" dateFormat="dd/mm/yy" placeholder="Pilih Tanggal"
                            size="small" appendTo="body">
                        </p-datepicker>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label>Jam Mulai</label>
                        <input type="time" pInputText formControlName="start_time" placeholder="Masukkan jam mulai"
                            size="small" appendTo="body" class="p-inputtext-sm">
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label>Jam Akhir</label>
                        <input type="time" pInputText formControlName="end_time" placeholder="Masukkan jam akhir"
                            size="small" appendTo="body" class="p-inputtext-sm">
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label>Total Jam</label>
                        <p-inputNumber formControlName="total_hours" [readonly]="true" placeholder="Dihitung Otomatis"
                            size="small" appendTo="body">
                        </p-inputNumber>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label>Tipe Lembur</label>
                        <p-select [options]="[
                { label: 'Hari Kerja', value: 'weekday' },
                { label: 'Hari Weekend', value: 'weekend' },
                { label: 'Hari Libur Umum', value: 'public-holiday' }
              ]" optionLabel="label" optionValue="value" formControlName="overtime_type" [showClear]="true"
                            placeholder="Pilih Tipe Lembur" size="small" appendTo="body">
                        </p-select>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label>Status</label>
                        <p-select [options]="[
                { label: 'Pending', value: 'pending' },
                { label: 'Approved', value: 'approved' },
                { label: 'Rejected', value: 'rejected' }
              ]" optionLabel="label" optionValue="value" formControlName="status" [showClear]="true"
                            placeholder="Pilih Status" size="small" appendTo="body">
                        </p-select>
                    </div>
                </div>
            </div>

            <div class="form-group mb-8">
                <label>Alasan Lembur</label>
                <textarea pTextarea formControlName="reason" rows="3" placeholder="Masukkan alasan lembur..."
                    class="p-inputtext-sm"></textarea>
            </div>

            <div class="flex flex-row justify-end items-center gap-5">
                <p-button [label]="_pageState() === 'create' ? 'Simpan' : 'Update'" [disabled]="OvertimeForm.invalid"
                    (onClick)="_pageState() === 'create' ? handleAddOvertime(OvertimeForm.value) : handleEditOvertime(OvertimeForm.value)"
                    size="small">
                </p-button>

                <p-button label="Batal" severity="secondary" (onClick)="handleBackToList()" size="small">
                </p-button>
            </div>
        </form>
    </div>
</app-dsh-base-layout>